<!DOCTYPE html>
<html>
  <head>
    <title>MyMapNow.com</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <%- if protect_against_forgery? -%>
      <meta name="authenticity-token" id="authenticity-token" content="<%= form_authenticity_token %>">
    <%- end -%>
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="http://j.maxmind.com/app/geoip.js"></script>
    <%= javascript_include_tag 'map', 'geoip', :cache => true %>
    <%= javascript_include_tag :jelly, *application_jelly_files %>
    <%= stylesheet_link_tag 'main' %>
    <%= spread_jelly %>
  </head>
  <body onload="Map.initialize(); Map.updateSearchBoxWithCurrentLocation(); loadItems();">
    <div id="mainContainer" style="height: 100%;">
      <div id="header">
	<span class="header-child"><img src="/images/logo.png" /></span>
	<span class="header-child"><input type="text" id="search-box" name="search-box" /></span>
	<span class="header-child">hello <input type="button" onclick="Map.search($('input[name=search-box]').val())" /></span>
      </div> 
      <div class="outer" style="height: 100%; bottom: 100px;">
	<div class="inner" style="height: 100%;">
	  <div class="float-wrap" style="height: 100%;">
            <div id="content" style="height: 100%;"> 
              <div class="contentWrap" style="height: 100%;">
		<div id="map" style="height: 100%; width: 100%;"></div>
              </div>
            </div>
            <!-- end centered div -->
            <div id="left">
	      <div id="item-details"></div>
            </div>
	    <!-- end left div -->
	  </div>
	  <div id="right"></div>
	  <!-- end right div -->
	</div>
      </div>
    </div>
    <div id="footer">
    <div id="footerLeft">dfsadf</div>
      <p>This is our footer</p>
    </div>
<script>
// FIXME: untested
var loadItems = function() {
  $.getJSON('/items', function(items) {
    jQuery.each(items, function(i) {
      var item = items[i]['item'];
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(item.latitude, item.longitude),
        map: Map.map
      });
      var itemHTML = '<span><strong><em>' + item['title'] + '</strong></em></span><br />';
   if (item['address']) { itemHTML += '<span><strong>Address: </strong>' + item['address'] + '</span>' };
   if (item['begin_at']) { itemHTML += '<span><strong>Time: </strong>' + item['begin_at'] + '</span>' };
   if (item['end_at']) { itemHTML += '<span> until ' + item['end_at'] + '</span>' };
   
         $('<div id="item-' + i + '">' + itemHTML + '</div><br /><hr style="width: 75%; color: black;"/>').appendTo('#item-details');
    });
  });
};
 </script>
  </body>
</html>
